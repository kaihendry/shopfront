{{ define "main" }}
{{ $sku := .File.ContentBaseName }}
<header>
<h2>{{.Title}}</h2>
<h4>Price: {{ lang.NumFmt 2 (div (float .Params.Price) 100) }} {{ $.Site.Params.currency }}</h4>
</header>

<div id="react"></div>
<script>
	const productData = [
		{
			name: '{{ .Title }}',
{{ if (fileExists (printf "data/price/%s.json" $sku)) }}
			sku: '{{ index (index .Site.Data.price $sku) "id" }}',
{{ end }}
			price: {{ .Params.Price }},
{{ if ( gt ( len (.Resources.ByType "image")) 0 ) }}
{{ range first 1 (.Resources.ByType "image") }}
{{ $image := .Fit "300x300" }}
			image: '{{ $image.Permalink }}',
{{ end }}
{{ else }}
			image: '/shop/noproductimage.png',
{{ end }}
			currency: '{{ $.Site.Params.currency }}'
		}
	]
</script>

{{.Content}}

<p style="color: #6c757d;">SKU: {{ $sku }}</p>
{{ if (fileExists (printf "data/price/%s.json" $sku)) }}
<p>Stripe price ID {{ index (index .Site.Data.price $sku) "id" }}</p>
{{ else }}
<p>stripe-sync.sh needs to be run since price ID for checkout is not found.</p>
{{ end }}
{{ end }}
